<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- CONFIGURA√á√ïES DO CABE√áALHO -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Torna o site responsivo em dispositivos m√≥veis -->
    <title>Painel Admin - IPB Guriri</title>
    
    <!-- IMPORTA√á√ÉO DE FONTES E √çCONES -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">


    <!-- ARQUIVOS CSS CUSTOMIZADOS -->
    <link rel="stylesheet" href="../css/global.css"> <!-- Estilos globais -->
    <link rel="stylesheet" href="../css/ui-elements.css"> <!-- Estilos de elementos de interface -->
    <link rel="stylesheet" href="../css/modal.css"> <!-- Estilos das janelas modais -->
    <link rel="stylesheet" href="../css/admin.css"> <!-- Estilos espec√≠ficos da √°rea administrativa -->
</head>
<body>


    <!-- ========================================
    OVERLAY DE LOGIN (TELA DE AUTENTICA√á√ÉO)
    ======================================== -->
    <aside id="loginOverlay" role="dialog" aria-labelledby="loginTitle" aria-modal="true">
        <article class="login-box">
            <!-- Logo da igreja -->
            <img src="../img/logo.png" alt="Logo IPB Guriri" style="height: 60px; margin-bottom: 15px;">
            <h2 id="loginTitle">√Årea Restrita</h2>
            <p style="color: #666; margin-bottom: 20px;">Digite a senha da lideran√ßa para acessar.</p>
            
            <!-- Formul√°rio de login -->
            <form onsubmit="event.preventDefault(); verificarAcesso();">
                <label for="senhaInput" class="sr-only">Senha de acesso</label>
                <input type="password" id="senhaInput" placeholder="Senha de acesso" required>
                <button type="submit" class="login-btn">Entrar</button>
            </form>
            
            <!-- Mensagem de erro (oculta inicialmente) -->
            <p id="msgErro" role="alert" style="color: red; margin-top: 10px; display: none; font-size: 0.9rem;">Senha incorreta!</p>
            
            <!-- Link para voltar √† p√°gina inicial -->
            <nav>
                <a href="./" style="display: block; margin-top: 20px; color: #888; text-decoration: none; font-size: 0.8rem;">Voltar ao In√≠cio</a>
            </nav>
        </article>
    </aside>


    <!-- ========================================
    CABE√áALHO DA P√ÅGINA ADMINISTRATIVA
    ======================================== -->
    <header>
        <nav aria-label="Navega√ß√£o secund√°ria">
            <a href="../../index.html" class="btn-voltar-hub" aria-label="Voltar para p√°gina inicial">‚¨Ö Voltar</a>
        </nav>
        <img src="../img/logo.png" alt="Logo IPB" class="logo">
        <h1>Gerenciador Administrativo</h1>
        <p id="statusMsg" role="status" aria-live="polite">Conectando ao sistema...</p> <!-- Status da conex√£o com o Firebase -->
    </header>


    <!-- ========================================
    CONTE√öDO PRINCIPAL
    ======================================== -->
    <main class="container">
        
        <!-- BARRA DE NAVEGA√á√ÉO E A√á√ïES -->
        <nav class="admin-actions-bar" aria-label="Navega√ß√£o principal e a√ß√µes">
            <!-- Abas de navega√ß√£o entre se√ß√µes -->
            <div class="tab-controls" role="tablist">
                <button type="button" class="btn-tab active" id="tabAgenda" role="tab" aria-selected="true" aria-controls="secaoAgenda" onclick="trocarAba('agenda')">
                    <span aria-hidden="true">üìÖ</span> Agenda
                </button>
                <button type="button" class="btn-tab" id="tabLideranca" role="tab" aria-selected="false" aria-controls="secaoLideranca" onclick="trocarAba('lideranca')">
                    <span aria-hidden="true">üë•</span> Lideran√ßa
                </button>
            </div>


            <!-- Bot√µes de a√ß√µes espec√≠ficas da aba Agenda -->
            <div id="acoesAgenda">
                <button type="button" class="btn-secondary" onclick="abrirModalTags()">
                    <i class="fas fa-tags" aria-hidden="true"></i> Gerenciar Sociedades
                </button>
                <button type="button" class="btn-secondary" onclick="abrirModalRecorrencia()">
                    <i class="fas fa-sync-alt" aria-hidden="true"></i> Criar Recorr√™ncia
                </button>
            </div>
        </nav>


        <!-- ========================================
        SE√á√ÉO 1: GERENCIAMENTO DE AGENDA
        ======================================== -->
        <section id="secaoAgenda" role="tabpanel" aria-labelledby="tabAgenda">
            
            <!-- CARD: FORMUL√ÅRIO DE CADASTRO/EDI√á√ÉO DE EVENTOS -->
            <article class="admin-card">
                <header class="card-header" id="formTitle">Adicionar Novo Evento</header>
                
                <form id="formEvento" onsubmit="event.preventDefault(); processarEvento();">
                    <!-- Linha com campos de Ano e M√™s -->
                    <div class="row-fields">
                        <div class="form-group" style="flex: 1;">
                            <label for="inputAno">Ano:</label>
                            <input type="number" id="inputAno" value="2026" required>
                        </div>
                        <div class="form-group" style="flex: 2;">
                            <label for="inputMes">M√™s:</label>
                            <select id="inputMes" required>
                                <option value="Janeiro">Janeiro</option>
                                <option value="Fevereiro">Fevereiro</option>
                                <option value="Mar√ßo">Mar√ßo</option>
                                <option value="Abril">Abril</option>
                                <option value="Maio">Maio</option>
                                <option value="Junho">Junho</option>
                                <option value="Julho">Julho</option>
                                <option value="Agosto">Agosto</option>
                                <option value="Setembro">Setembro</option>
                                <option value="Outubro">Outubro</option>
                                <option value="Novembro">Novembro</option>
                                <option value="Dezembro">Dezembro</option>
                            </select>
                        </div>
                    </div>


                    <!-- Grade de sele√ß√£o de dias (preenchida via JavaScript) -->
                    <fieldset class="form-group">
                        <legend>Selecione o(s) Dia(s):</legend>
                        <div class="day-grid" id="dayGrid" role="group" aria-label="Sele√ß√£o de dias do m√™s"></div>
                    </fieldset>


                    <!-- Campo para nome do evento -->
                    <div class="form-group">
                        <label for="inputNome">Nome do Evento:</label>
                        <input type="text" id="inputNome" placeholder="Ex: Culto de Doutrina" required>
                    </div>


                    <!-- Campo para descri√ß√£o (opcional) -->
                    <div class="form-group">
                        <label for="inputDescricao">Descri√ß√£o (Opcional):</label>
                        <textarea id="inputDescricao" placeholder="Ex: Preletor: Rev. Fulano..."></textarea>
                    </div>


                    <!-- Linha com campos de Hor√°rio e Local -->
                    <div class="row-fields">
                        <div class="form-group">
                            <label for="inputHorario">Hor√°rio:</label>
                            <input type="time" id="inputHorario">
                        </div>
                        <div class="form-group">
                            <label for="inputLocal">Local:</label>
                            <input type="text" id="inputLocal" placeholder="Ex: Templo">
                        </div>
                    </div>


                    <!-- Campo para selecionar a sociedade (tag) -->
                    <div class="form-group">
                        <label for="inputTag">Sociedade (Tag):</label>
                        <div style="display: flex; gap: 10px;">
                            <select id="inputTag" style="flex: 1;"><option value="">Nenhuma</option></select>
                            <!-- Bot√£o para abrir modal de gerenciamento de sociedades -->
                            <button type="button" id="cadastrarTag" class="btn-inline-add" onclick="abrirModalTags()" title="Gerenciar Sociedades" aria-label="Gerenciar sociedades">
                                <i class="fas fa-plus" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>


                    <!-- Bot√µes de a√ß√£o do formul√°rio -->
                    <div class="btn-row">
                        <button type="submit" class="btn-add" id="btnSalvar">
                            <span aria-hidden="true">üíæ</span> Salvar Evento
                        </button>
                        <button type="button" class="btn-cancel" id="btnCancelar" onclick="cancelarEdicao()" style="display:none;">Cancelar Edi√ß√£o</button>
                    </div>
                </form>
            </article>


            <!-- CARD: LISTA DE EVENTOS CADASTRADOS -->
            <article class="admin-card">
                <header class="card-header">Eventos Cadastrados</header>
                <div id="listaPreview" role="region" aria-live="polite">Carregando dados...</div> <!-- Lista preenchida via JavaScript -->
            </article>
        </section>


        <!-- ========================================
        SE√á√ÉO 2: GERENCIAMENTO DE LIDERAN√áA
        (Oculta inicialmente)
        ======================================== -->
        <section id="secaoLideranca" role="tabpanel" aria-labelledby="tabLideranca" style="display: none;">
            
            <!-- CARD: FORMUL√ÅRIO DE CADASTRO/EDI√á√ÉO DE MEMBROS -->
            <article class="admin-card">
                <header class="card-header" id="tituloMembro">Cadastrar Lideran√ßa / Membro</header>
                
                <form id="formMembro" onsubmit="event.preventDefault(); salvarMembro();">
                    <!-- Campo para nome completo -->
                    <div class="form-group">
                        <label for="membroNome">Nome Completo:</label>
                        <input type="text" id="membroNome" placeholder="Ex: Jo√£o Silva" required>
                    </div>


                    <!-- Linha com campos de Sociedade, Telefone e Cargo -->
                    <div class="row-fields">
                        <div class="form-group">
                            <label for="membroSociedade">Sociedade:</label>
                            <select id="membroSociedade" required>
                                <option value="">Carregando sociedades...</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="membroTelefone">Telefone (WhatsApp):</label>
                            <input type="tel" id="membroTelefone" placeholder="(27) 99999-9999">
                        </div>


                        <div class="form-group">
                            <label for="membroCargoSelect">Cargo / Fun√ß√£o:</label>
                            <div style="display: flex; gap: 10px;">
                                <select id="membroCargoSelect" style="flex: 1;" required>
                                    <option value="">Selecione...</option>
                                </select>
                                <!-- Bot√£o para abrir modal de gerenciamento de cargos -->
                                <button type="button" class="btn-inline-add" onclick="abrirModalCargos()" title="Gerenciar Cargos" aria-label="Gerenciar cargos">
                                    <i class="fas fa-plus" aria-hidden="true"></i>
                                </button>
                            </div>
                        </div>
                    </div>


                    <!-- Bot√µes de a√ß√£o do formul√°rio -->
                    <div class="btn-row">
                        <button type="submit" class="btn-add" id="btnSalvarMembro">
                            <span aria-hidden="true">üíæ</span> Salvar na Lideran√ßa
                        </button>
                        <button type="button" class="btn-cancel" id="btnCancelarMembro" onclick="cancelarEdicaoMembro()" style="display:none;">Cancelar Edi√ß√£o</button>
                    </div>
                </form>
            </article>


            <!-- CARD: TABELA DE MEMBROS CADASTRADOS -->
            <article class="admin-card">
                <header class="card-header">Membros Cadastrados</header>
                <table class="tags-table">
                    <thead>
                        <tr>
                            <th scope="col">NOME</th>
                            <th scope="col">SOCIEDADE</th>
                            <th scope="col">CARGO</th>
                            <th scope="col" style="text-align:right">A√á√ïES</th>
                        </tr>
                    </thead>
                    <tbody id="listaLideranca">
                        <!-- Linhas preenchidas via JavaScript -->
                    </tbody>
                </table>
            </article>
        </section>
    </main>


    <!-- Container para notifica√ß√µes toast -->
    <aside id="toast-container" role="status" aria-live="polite" aria-atomic="true"></aside>



    <!-- ========================================
    MODAL 1: GERENCIAR SOCIEDADES
    ======================================== -->
    <dialog id="modalTags" class="modal-overlay" aria-labelledby="tituloModalTags">
        <article class="modal-content">
            <header class="modal-header">
                <h2 id="tituloModalTags"><span aria-hidden="true">üè∑Ô∏è</span> Gerenciar Sociedades</h2>
                <button type="button" class="btn-close-modal" onclick="fecharModais()" aria-label="Fechar modal">&times;</button>
            </header>
            <section class="modal-body">
                <!-- Formul√°rio para criar nova sociedade -->
                <form class="tag-form-row" style="display: flex; gap: 10px; margin-bottom: 20px; align-items: center;" onsubmit="event.preventDefault(); criarTagNoModal();">
                    <label for="newTagName" class="sr-only">Nome da sociedade</label>
                    <input type="text" id="newTagName" placeholder="Ex: SAF, UMP..." style="flex:1;" required>
                    <label for="newTagColor" class="sr-only">Cor da sociedade</label>
                    <input type="color" id="newTagColor" value="#074528" title="Selecionar cor"> <!-- Seletor de cor -->
                    <button type="submit" class="btn-add btn-add-fix">+ Criar</button>
                </form>
                <!-- Tabela com sociedades existentes -->
                <table class="tags-table">
                    <thead>
                        <tr>
                            <th scope="col">NOME</th>
                            <th scope="col" style="text-align:center">COR</th>
                            <th scope="col" style="text-align:right">A√á√ïES</th>
                        </tr>
                    </thead>
                    <tbody id="listaTagsEditaveis"></tbody> <!-- Preenchido via JavaScript -->
                </table>
            </section>
        </article>
    </dialog>


    <!-- ========================================
    MODAL 2: GERENCIAR CARGOS
    ======================================== -->
    <dialog id="modalCargos" class="modal-overlay" aria-labelledby="tituloModalCargos">
        <article class="modal-content">
            <header class="modal-header">
                <h2 id="tituloModalCargos"><span aria-hidden="true">üéì</span> Gerenciar Cargos</h2>
                <button type="button" class="btn-close-modal" onclick="fecharModais()" aria-label="Fechar modal">&times;</button>
            </header>
            <section class="modal-body">
                <!-- Formul√°rio para criar novo cargo -->
                <form class="tag-form-row" style="display: flex; gap: 10px; align-items: center;" onsubmit="event.preventDefault(); criarCargoNoModal();">
                    <label for="newCargoName" class="sr-only">Nome do cargo</label>
                    <input type="text" id="newCargoName" placeholder="Ex: Presidente, Di√°cono..." style="flex:1; height: 40px;" required>
                    <button type="submit" class="btn-add btn-add-fix">+ ADICIONAR</button>
                </form>
                <!-- Tabela com cargos existentes -->
                <table class="tags-table">
                    <thead>
                        <tr>
                            <th scope="col">CARGO</th>
                            <th scope="col" style="text-align:right">A√á√ïES</th>
                        </tr>
                    </thead>
                    <tbody id="listaCargosEditaveis"></tbody> <!-- Preenchido via JavaScript -->
                </table>
            </section>
        </article>
    </dialog>


    <!-- ========================================
    MODAL 3: CRIAR EVENTOS RECORRENTES
    ======================================== -->
    <dialog id="modalRecorrencia" class="modal-overlay" aria-labelledby="tituloModalRecorrencia">
        <article class="modal-content">
            <header class="modal-header">
                <h2 id="tituloModalRecorrencia"><span aria-hidden="true">üîÑ</span> Gerar Recorr√™ncia</h2>
                <button type="button" class="btn-close-modal" onclick="fecharModais()" aria-label="Fechar modal">&times;</button>
            </header>
            <section class="modal-body">
                <form id="formRecorrencia" onsubmit="event.preventDefault(); gerarEventosRecorrentes();">
                    <!-- Dados b√°sicos do evento recorrente -->
                    <div class="form-group">
                        <label for="recNome">Nome do Evento:</label>
                        <input type="text" id="recNome" required>
                    </div>
                    <div class="form-group">
                        <label for="recDescricao">Descri√ß√£o:</label>
                        <textarea id="recDescricao"></textarea>
                    </div>
                    <div class="row-fields">
                        <div class="form-group">
                            <label for="recHorario">Hor√°rio:</label>
                            <input type="time" id="recHorario">
                        </div>
                        <div class="form-group">
                            <label for="recTag">Sociedade:</label>
                            <select id="recTag"></select>
                        </div>
                    </div>
                    
                    <!-- Op√ß√µes de tipo de repeti√ß√£o -->
                    <fieldset class="form-group">
                        <legend>Repeti√ß√£o:</legend>
                        <!-- Seletor de tipo: Semanal ou Mensal -->
                        <div class="recurrence-type-selector">
                            <label class="rec-type-label">
                                <input type="radio" name="recType" value="semanal" checked onclick="toggleRecMode()"> Semanal
                            </label>
                            <label class="rec-type-label">
                                <input type="radio" name="recType" value="mensal" onclick="toggleRecMode()"> Mensal
                            </label>
                        </div>
                        
                        <!-- Op√ß√£o 1: Recorr√™ncia Semanal (dias da semana) -->
                        <fieldset id="optSemanal" class="rec-options-group active">
                            <legend class="sr-only">Selecione os dias da semana</legend>
                            <div class="week-days-selector" style="display: flex; flex-wrap: wrap; gap: 10px;">
                                <label><input type="checkbox" value="0"> Dom</label>
                                <label><input type="checkbox" value="1"> Seg</label>
                                <label><input type="checkbox" value="2"> Ter</label>
                                <label><input type="checkbox" value="3"> Qua</label>
                                <label><input type="checkbox" value="4"> Qui</label>
                                <label><input type="checkbox" value="5"> Sex</label>
                                <label><input type="checkbox" value="6"> S√°b</label>
                            </div>
                        </fieldset>
                        
                        <!-- Op√ß√£o 2: Recorr√™ncia Mensal (ex: toda primeira segunda-feira) -->
                        <div id="optMensal" class="rec-options-group">
                            <div class="inline-selects">
                                <label for="recMensalOrdem" class="sr-only">Ordem</label>
                                <select id="recMensalOrdem">
                                    <option value="1">Primeiro(a)</option>
                                    <option value="2">Segundo(a)</option>
                                    <option value="3">Terceiro(a)</option>
                                    <option value="4">Quarto(a)</option>
                                    <option value="5">√öltimo(a)</option>
                                </select>
                                <label for="recMensalDia" class="sr-only">Dia da semana</label>
                                <select id="recMensalDia">
                                    <option value="0">Domingo</option>
                                    <option value="1">Segunda</option>
                                    <option value="2">Ter√ßa</option>
                                    <option value="3">Quarta</option>
                                    <option value="4">Quinta</option>
                                    <option value="5">Sexta</option>
                                    <option value="6">S√°bado</option>
                                </select>
                            </div>
                        </div>
                    </fieldset>


                    <!-- Per√≠odo de aplica√ß√£o da recorr√™ncia -->
                    <div class="row-fields">
                        <div class="form-group">
                            <label for="recAno">Ano:</label>
                            <input type="number" id="recAno" value="2026" required>
                        </div>
                        <div class="form-group">
                            <label for="recMesInicio">De:</label>
                            <select id="recMesInicio">
                                <option value="0">Janeiro</option>
                                <option value="1">Fevereiro</option>
                                <option value="2">Mar√ßo</option>
                                <option value="3">Abril</option>
                                <option value="4">Maio</option>
                                <option value="5">Junho</option>
                                <option value="6">Julho</option>
                                <option value="7">Agosto</option>
                                <option value="8">Setembro</option>
                                <option value="9">Outubro</option>
                                <option value="10">Novembro</option>
                                <option value="11">Dezembro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="recMesFim">At√©:</label>
                            <select id="recMesFim">
                                <option value="0">Janeiro</option>
                                <option value="1">Fevereiro</option>
                                <option value="2">Mar√ßo</option>
                                <option value="3">Abril</option>
                                <option value="4">Maio</option>
                                <option value="5">Junho</option>
                                <option value="6">Julho</option>
                                <option value="7">Agosto</option>
                                <option value="8">Setembro</option>
                                <option value="9">Outubro</option>
                                <option value="10">Novembro</option>
                                <option value="11">Dezembro</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Bot√£o para executar a gera√ß√£o dos eventos -->
                    <button type="submit" class="btn-add">
                        <span aria-hidden="true">üöÄ</span> Gerar Eventos
                    </button>
                </form>
            </section>
        </article>
    </dialog>


    <!-- ========================================
    SCRIPTS JAVASCRIPT
    ======================================== -->
    <!-- Firebase SDK - Biblioteca para conex√£o com banco de dados -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <!-- Scripts customizados da aplica√ß√£o -->
    <script src="../js/config.js"></script> <!-- Configura√ß√µes do Firebase -->
    <script src="../js/admin.js"></script> <!-- L√≥gica administrativa (fun√ß√µes e eventos) -->
</body>
</html>
